---
title: "ãƒªãƒ³ã‚°ãƒ•ã‚£ãƒƒãƒˆã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã®è¨˜éŒ²ã§å‹é”ã¨ç«¶ãˆã‚‹ä»•çµ„ã¿ã‚’ä½œã£ãŸ"
emoji: "ğŸ‹ï¸â€â™€ï¸"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['GAS', 'JavaScript', 'Slack', 'è‡ªå‹•åŒ–']
published: true
---

# ğŸ£ ã¯ã˜ã‚ã«

ãŠã†ã¡ã§æ°—è»½ã«ãƒ•ã‚£ãƒƒãƒˆãƒã‚¹ãŒã§ãã‚‹ã€Œãƒªãƒ³ã‚°ãƒ•ã‚£ãƒƒãƒˆã‚¢ãƒ‰ãƒ™ãƒ³ãƒãƒ£ãƒ¼ã€ã€‚
ä¸€äººã§ãŒã‚“ã°ã‚‹ã®ã‚‚ã„ã„ã‘ã©ã¿ã‚“ãªã§ç«¶ã„åˆã£ãŸã»ã†ãŒã‚‚ã£ã¨æ¥½ã—ã„ã—ç¶™ç¶šã§ãã‚‹ã‚ˆã­ï¼ã£ã¦ã“ã¨ã§ã€ãã‚“ãªä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã—ãŸã€‚

å…·ä½“çš„ã«ã¯

- é‹å‹•çµæœã®Slacké€šçŸ¥ï¼ˆã€Œä»Šæ—¥ã‚‚ã¡ã‚ƒã‚“ã¨é‹å‹•ã—ã¦å‰ã„ï¼ã€ï¼‰
- é‹å‹•çµæœãƒ‡ãƒ¼ã‚¿ã®ãƒ­ã‚°ä¿å­˜ï¼ˆã„ã¤ãƒ»ã ã‚ŒãŒãƒ»ã©ã‚Œãã‚‰ã„é‹å‹•ã—ãŸã‹ï¼‰
- ãƒ­ã‚°ã®é›†è¨ˆãƒ»å¯è¦–åŒ–ãƒ»é€šçŸ¥ï¼ˆã€Œ8æœˆã®ã‚«ãƒ­ãƒªãƒ¼éƒ¨é–€ï¼‘ä½ã¯â—‹ã•ã‚“ã§ã—ãŸï¼ã€ï¼‰

ã‚’è‡ªå‹•åŒ–ã—ã¦ã„ã¾ã™ã€‚

é‹å‹•çµæœã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’Twitterã«æŠ•ç¨¿ã™ã‚‹ã ã‘ã§å‚åŠ ã§ãã¾ã™ã€‚
ã“ã®ä»•çµ„ã¿ã‚’ä½œã£ã¦ã‹ã‚‰ã€ä»Šã§ã¯10äººãã‚‰ã„ã§ã‚ã¡ã‚ƒã‚ã¡ã‚ƒæ¥½ã—ãã‚„ã£ã¦ã¾ã™ã€‚
ã¾ãŸå¾Œè¿°ã—ã¾ã™ãŒã€ã™ã¹ã¦ç„¡æ–™æ ã§é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚

## ä¸»ãªæ©Ÿèƒ½

1. Twitterã®æŠ•ç¨¿ã‚’æ¤œçŸ¥ã—ã¦Slackã«é€šçŸ¥ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/70c011418329c5ad2b391da4.png)

2. æ¯é€±æœˆæ›œæ—¥ã«é€²æ—ã‚’ãŠçŸ¥ã‚‰ã›ã—ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/4b85b60ba9eab28482d3ce68.png)

3. æœˆåˆã«å‰æœˆã®ã‚µãƒãƒªãƒ¼ã‚’æŠ•ç¨¿ã—ã¾ã™ã€‚ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã ã‘äººåŠ›ğŸ¤«ï¼‰
![](https://storage.googleapis.com/zenn-user-upload/d632ef4bde868b008522f0e9.png)

# ğŸ¯ æŠ€è¡“çš„ãªãƒã‚¤ãƒ³ãƒˆ

![](https://storage.googleapis.com/zenn-user-upload/612ac8536809490dc3791424.png)

ä½¿ã£ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã¯ä»¥ä¸‹ã®ã¨ãŠã‚Šã§ã™ã€‚
- pipedream
- Google Apps Script(GAS)

ã™ã¹ã¦ç„¡æ–™æ ã§é‹ç”¨ã—ã¦ã„ã¾ã™ã€‚


## pipedream
https://pipedream.com
pipedreamã¯ã„ã‚ã‚“ãªAPIã‚’ã¤ãªã’ã¦ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚µã‚¯ãƒƒã¨ä½œã‚Œã¡ã‚ƒã†ã€ã„ã‚ã‚†ã‚‹iPaaSã§ã™ã€‚Zapierã‚ˆã‚Šå®‰ã„ã—ï¼ˆç„¡æ–™æ ã§ãŸã„ã¦ã„äº‹è¶³ã‚Šã‚‹ï¼‰é€£æºã—ã¦ã‚‹APIã‚‚å¤šã„ã®ã§ã‚ˆãä½¿ã£ã¦ã„ã¾ã™ã€‚ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚

ä»Šå›ã¯ã€
- TwitteræŠ•ç¨¿ã®ç›£è¦–
- Slackã«æŠ•ç¨¿
- æŠ•ç¨¿ã•ã‚ŒãŸã‚¹ã‚¯ã‚·ãƒ§ã‚’Google Driveã«ä¿å­˜

ã¨ã„ã†ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œã£ã¦ã„ã¾ã™ã€‚
![](https://storage.googleapis.com/zenn-user-upload/1ee2ff9419211b81f9def73b.png)

## Google Apps Script(GAS)
GASã§ã¯é‹å‹•ãƒ­ã‚°ã®ä¿å­˜ã¨Slacké€šçŸ¥ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚

### é‹å‹•ãƒ­ã‚°ã®ä¿å­˜

é‹å‹•ãƒ­ã‚°ã®ä¿å­˜ã¯

- Google Driveã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ç”»åƒã‚’å–å¾—
- ç”»åƒã«OCRã‚’å®Ÿè¡Œ
- OCRçµæœã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¦ã‚·ãƒ¼ãƒˆã«å‡ºåŠ›

ã¨ã„ã†æµã‚Œã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚
ãªã‚“ã¨OCRãŒç„¡æ–™ã§ä½¿ãˆã‚‹ã®ã§ã™ã€‚Googleæ§˜æ§˜ã§ã™ã­ã€‚

OCRã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã«[Drive API(V2)](https://developers.google.com/drive/api/v2/reference)ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¾ã™ã€‚
```js
function appendRowFromImage() {
  // ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«å…¥ã£ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’å–å¾—
  const result = Drive.Children.list(folderId, { q: "mimeType = 'image/jpeg'" })

  // ãªã«ã‚‚å…¥ã£ã¦ãªã‘ã‚Œã°çµ‚äº†
  if (result.items.length === 0) return;

  const ss = SpreadsheetApp.openById('##SHEET_ID##');
  const sheet = ss.getSheetByName('db');

  const resource = { title: "test" };
  const option = {
    "ocr": true,
    "ocrLanguage": "ja",
  };

  result.items.forEach(item => {
    const fileId = item.id;
    const file = Drive.Files.get(fileId);
    const date = Utilities.formatDate(new Date(file.createdDate), "JST", "yyyy-MM-dd HH:mm:ss");

    // ç”»åƒã‚’ã‚³ãƒ”ãƒ¼ã—ã¦OCRã‚’å®Ÿè¡Œã™ã‚‹
    const image = Drive.Files.copy(resource, fileId, option)
    // OCRã®ãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—ã™ã‚‹
    const ocrText = DocumentApp.openById(image.id).getBody().getText();
    // ã‚³ãƒ”ãƒ¼ç”»åƒã¯ã‚‚ã†ä¸è¦ãªã®ã§å‰Šé™¤
    Drive.Files.remove(image.id)
    // OCRã®ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰å¿…è¦æƒ…å ±ã‚’æŠ½å‡º
    const { user, hour, minite, second, kcal, km } = extractData(ocrText);
    // ã‚·ãƒ¼ãƒˆã«è¿½åŠ 
    sheet.appendRow([date, user, hour, minite, second, kcal, km])
    // ã‚¹ã‚¯ã‚·ãƒ§ç”»åƒã‚‚ã‚‚ã†ä¸è¦ãªã®ã§å‰Šé™¤
    Drive.Files.remove(fileId);
  })

}
```

ã“ã‚“ãªæ„Ÿã˜ã§ãƒ­ã‚°ãŒä¿å­˜ã•ã‚Œã¦ã„ãã¾ã™ ğŸ‘‡
![](https://storage.googleapis.com/zenn-user-upload/b84b6e24db40fea5760fc30a.png)

### ãƒ­ã‚°ã®é›†è¨ˆãƒ»å¯è¦–åŒ–
ã‚·ãƒ¼ãƒˆã«ãƒ­ã‚°ãŒã©ã‚“ã©ã‚“æºœã¾ã£ã¦ã„ãã®ã§ã€ã‚ã¨ã¯ã‚¹ãƒ—ã‚·èŠ¸ã‚’é§†ä½¿ã—ã¦æ–™ç†ã—ã¦ã„ãã ã‘ã§ã™ã€‚
`QUERY`, `ARRAY_FORMULA`, `VLOOKUP`ã‚ãŸã‚Šã§ã‚´ãƒ‹ãƒ§ã‚´ãƒ‹ãƒ§ã—ã¦ã€å‰æœˆã€å½“æœˆã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã€ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚
ï¼ˆã‚«ãƒ­ãƒªãƒ¼ã®ä»–ã€ãƒ—ãƒ¬ã‚¤æ™‚é–“ãƒ»èµ°è¡Œè·é›¢ãƒ»ãƒ—ãƒ¬ã‚¤å›æ•°ã§ã‚‚ãƒãƒ£ãƒ¼ãƒˆã‚’ä½œã£ã¦ã„ã¾ã™ï¼‰

![](https://storage.googleapis.com/zenn-user-upload/e386253f3b496b97cad861bf.png)

ã‚ã¨ã¯ã€

- ãƒãƒ£ãƒ¼ãƒˆã‚’ç”»åƒåŒ–ã—ã¦Google Driveã«ä¿å­˜
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—
- Slackã«æŠ•ç¨¿

ã¨ã„ã†å‡¦ç†ã‚’GASã§å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã‚³ãƒ¼ãƒ‰ã‚’æŠœç²‹ã—ã¾ã™ã€‚

```js
function postProgressToSlackChannel() {
  const charts = getCharts("current_month");
  const attachments = []
  charts.forEach((chart, i) => {
    const imageUrl = getImageUrl(chart);
    const title = chart.getOptions().get("title");
    attachments.push({
      fields: [
        {
          title: title
        }
      ],
      image_url: imageUrl
    })
  });

  const channel = "###CHANNEL_ID###";
  const token = PropertiesService.getScriptProperties().getProperty("SLACK_BOT_TOKEN");
  const apiResponse = callWebApi(token, "chat.postMessage", {
    channel: channel,
    text: "ãƒãƒ­ãƒãƒ­ãƒ¼ï¼ï¼ä»Šæœˆã®é€²æ—ã¯ã‚³ãƒãƒ©ï¼ï¼",
    attachments: attachments
  });
}

function getCharts(sheetName) {
  const ss = SpreadsheetApp.openById("##SHEEET_ID##");
  const sheet = ss.getSheetByName(sheetName);
  return sheet.getCharts();
}

function getImageUrl(chart) {
  const today = Utilities.formatDate(new Date(), 'Asia/Tokyo', 'YYYY-MM-dd');

  const graphImg = chart.getBlob();
  const chartId = chart.getChartId();
  const folderId = '###FOLDER_ID###';
  const folder = DriveApp.getFolderById(folderId);
  const file = folder.createFile(graphImg);
  file.setName(`${today}_${chartId}`);

  // Slackã«æŠ•ç¨¿ã™ã‚‹ç”»åƒãªã®ã§å…¬é–‹è¨­å®šã™ã‚‹
  file.setSharing(DriveApp.Access.ANYONE_WITH_LINK, DriveApp.Permission.VIEW)
  const imageUrl = file.getDownloadUrl();
  return imageUrl;
}
```

# ğŸ’¡ å·¥å¤«ã—ãŸã¨ã“ã‚

## Twitteré€£æºã¯å…±æœ‰ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§

å†™çœŸæŠ•ç¨¿ã«ã¯å…±æœ‰ç”¨ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚

å„ã€…ãŒTwitterã«ã‚·ã‚§ã‚¢ã—ãŸå†™çœŸã‚’ãªã«ã‹ã—ã‚‰ã®æ–¹æ³•ï¼ˆç‰¹å®šã®ãƒãƒƒã‚·ãƒ¥ã‚¿ã‚°ç­‰ï¼‰ã§æ‹¾ã£ã¦ãã‚‹æ‰‹ã‚‚ã‚ã‚Šã¾ã™ãŒã€

- æŠ•ç¨¿æ™‚ã«Switchã§è¿½åŠ ã§æ–‡å­—ã‚’æ‰“ã¤ã®ãŒã¨ã«ã‹ãã‚ã‚“ã©ãã•ã„
- è‡ªåˆ†ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§æ¯å›æŠ•ç¨¿ã—ã¦TLã‚’æ±šã™ã®ã¤ã‚‰ã„

ã¨ã„ã†ãƒšã‚¤ãƒ³ãŒã‚ã‚Šã¾ã™ã€‚

å…±æœ‰ç”¨ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é€£æºã—ã¦ãŠã‘ã°ã€

1. ã‚²ãƒ¼ãƒ çµ‚äº†å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹ã€Œæœ¬æ—¥ã®é‹å‹•çµæœã€ã‚’ã‚¹ã‚¯ã‚·ãƒ§ã™ã‚‹
1. ã‚®ãƒ£ãƒ©ãƒªãƒ¼ãƒšãƒ¼ã‚¸ã‹ã‚‰è©²å½“ã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’é¸æŠã—ã¦Twitterã«æŠ•ç¨¿ã™ã‚‹

ãŸã ã“ã‚Œã ã‘ã§ä½œæ¥­ã¯å®Œäº†ã§ã™ã€‚
å®Ÿè³ªã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰æ±ºå®šãƒœã‚¿ãƒ³é€£æ‰“ã™ã‚‹ã ã‘ã§ã™ã€‚
ã“ã‚Œãªã‚‰æ€ æƒ°ãªäººã§ã‚‚ç¶™ç¶šã§ãã¾ã™ã€‚ãã£ã¨ã€‚

## ãƒœãƒ‡ã‚£ãƒ“ãƒ«ãƒ€ãƒ¼æ›ã‘å£°

ãƒ©ãƒ³ãƒ€ãƒ ã§ãƒœãƒ‡ã‚£ãƒ“ãƒ«ãƒ€ãƒ¼ã¸ã®æ›ã‘å£°ã‚’å«ã‚“ã§ãã‚Œã¾ã™ã€‚100ç¨®é¡ãã‚‰ã„ã‚ã‚Šã¾ã™ã€‚
ã‚¬ãƒãƒ£è¦ç´ ãŒã‚ã‚‹ã¨æ¥½ã—ã„ã§ã™ã‚ˆã­ã€‚
![](https://storage.googleapis.com/zenn-user-upload/4480603a2fd74eb37065c6ab.png)

# ğŸ¤ ä»Šå¾Œã‚„ã£ã¦ã„ããŸã„ã“ã¨

## OCRæ”¹å–„
OCRã®çµæœãŒãŸã¾ãƒ¼ã«ãƒŸã‚¹ã£ã¦ã‚‹ã¨ããŒã‚ã‚‹ã®ã§æ”¹å–„ã—ã¦ã„ãã¾ã™ã€‚
Cloudinaryç­‰ã®ç”»åƒåŠ å·¥ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã£ã¦ä½™åˆ†ãªéƒ¨åˆ†ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ç­‰ï¼‰ã‚’é™¤å»ã—ã¦ã‹ã‚‰OCRã‚’å®Ÿè¡Œã™ã‚Œã°ã†ã¾ãã„ããã†ã€‚ã‚„ã£ã¦ã„ãï¼ ğŸ’ª
![](https://storage.googleapis.com/zenn-user-upload/060c0a6a0eaad25c3b7835c1.png)


# ğŸ£ ãŠã‚ã‚Šã«

åœ¨å®…ãƒ¯ãƒ¼ã‚¯ã§æœ€è¿‘ãœã‚“ãœã‚“é‹å‹•ã—ã¦ã„ãªã„ãã“ã®ã‚ãªãŸï¼
é‹å‹•ä¸è¶³ã«ã‚ˆã‚‹ç–¾ç—…ãƒªã‚¹ã‚¯ã¯æ·±åˆ»ã§ã™ã€‚
æ¥½ã—ãé‹å‹•ã—ã¦ä¸€ç·’ã«å¥åº·çš„ãªç”Ÿæ´»ã‚’é€ã‚Šã¾ã—ã‚‡ã†ï¼

ã¼ããŒå‚åŠ ã—ã¦ã„ã‚‹Slackã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚’è²¼ã£ã¦ãŠãã¾ã™ã€‚èˆˆå‘³ãŒã‚ã‚Œã°ã©ã†ãã€‚
https://community.camp-fire.jp/projects/view/280040